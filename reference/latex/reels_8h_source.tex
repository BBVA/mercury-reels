\hypertarget{reels_8h_source}{}\doxysection{reels.\+h}
\label{reels_8h_source}\index{reels/reels.h@{reels/reels.h}}
\mbox{\hyperlink{reels_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* Mercury-\/Reels}}
\DoxyCodeLine{2 \textcolor{comment}{}}
\DoxyCodeLine{3 \textcolor{comment}{    Copyright 2023 Banco Bilbao Vizcaya Argentaria, S.A.}}
\DoxyCodeLine{4 \textcolor{comment}{}}
\DoxyCodeLine{5 \textcolor{comment}{    This product includes software developed at}}
\DoxyCodeLine{6 \textcolor{comment}{}}
\DoxyCodeLine{7 \textcolor{comment}{    BBVA (https://www.bbva.com/)}}
\DoxyCodeLine{8 \textcolor{comment}{}}
\DoxyCodeLine{9 \textcolor{comment}{      Licensed under the Apache License, Version 2.0 (the "{}License"{});}}
\DoxyCodeLine{10 \textcolor{comment}{    you may not use this file except in compliance with the License.}}
\DoxyCodeLine{11 \textcolor{comment}{    You may obtain a copy of the License at}}
\DoxyCodeLine{12 \textcolor{comment}{}}
\DoxyCodeLine{13 \textcolor{comment}{    http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{14 \textcolor{comment}{}}
\DoxyCodeLine{15 \textcolor{comment}{      Unless required by applicable law or agreed to in writing, software}}
\DoxyCodeLine{16 \textcolor{comment}{    distributed under the License is distributed on an "{}AS IS"{} BASIS,}}
\DoxyCodeLine{17 \textcolor{comment}{    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.}}
\DoxyCodeLine{18 \textcolor{comment}{    See the License for the specific language governing permissions and}}
\DoxyCodeLine{19 \textcolor{comment}{    limitations under the License.}}
\DoxyCodeLine{20 \textcolor{comment}{*/}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <map>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include <set>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <time.h>}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include <cstdint>}}
\DoxyCodeLine{31 }
\DoxyCodeLine{32 \textcolor{preprocessor}{\#ifdef DEBUG}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{preprocessor}{\#ifdef TEST}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#ifndef INCLUDED\_CATCH2}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#define INCLUDED\_CATCH2}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include "{}catch.hpp"{}}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{preprocessor}{\#ifndef INCLUDED\_REELS\_TYPES}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#define INCLUDED\_REELS\_TYPES}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51 }
\DoxyCodeLine{55 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacereels}{reels}}}
\DoxyCodeLine{56 \{}
\DoxyCodeLine{57 }
\DoxyCodeLine{58 \textcolor{preprocessor}{\#define IMAGE\_BUFF\_SIZE         6136                    }}
\DoxyCodeLine{59 \textcolor{preprocessor}{\#define PRIORITY\_SEEN\_FACTOR    2000000000              }}
\DoxyCodeLine{60 \textcolor{preprocessor}{\#define DEFAULT\_NUM\_EVENTS      1000                    }}
\DoxyCodeLine{61 \textcolor{preprocessor}{\#define MAX\_SEQ\_LEN\_IN\_PREDICT  1000                    }}
\DoxyCodeLine{62 \textcolor{preprocessor}{\#define PREDICT\_MAX\_TIME        (100*365.25*24*3600)    }}
\DoxyCodeLine{63 \textcolor{preprocessor}{\#define WEIGHT\_PRECISION        10000                   }}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{keyword}{typedef} uint64\_t                        \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}}; }
\DoxyCodeLine{66 \textcolor{keyword}{typedef} std::string                     \mbox{\hyperlink{namespacereels_a8439b64892718b921e015accbfad1478}{String}};           }
\DoxyCodeLine{67 \textcolor{keyword}{typedef} \textcolor{keyword}{const} \textcolor{keywordtype}{char} *                    \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}};         }
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{keyword}{typedef} time\_t                          \mbox{\hyperlink{namespacereels_a4a78105f5e060eeedd5b522e287efc9d}{TimePoint}};     }
\DoxyCodeLine{70 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }tm                       \mbox{\hyperlink{namespacereels_ab2c2070f5faa49767ec138bd7c6b8db5}{TimeStruct}};       }
\DoxyCodeLine{71 \textcolor{keyword}{typedef} \textcolor{keywordtype}{double}                          \mbox{\hyperlink{namespacereels_a0e17cc783e9a6a6e802c866ec6c9f003}{ExtFloat}};       }
\DoxyCodeLine{72 }
\DoxyCodeLine{73 }
\DoxyCodeLine{78 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1ImageBlock}{ImageBlock}} \{}
\DoxyCodeLine{79     \textcolor{keywordtype}{int} \mbox{\hyperlink{structreels_1_1ImageBlock_ac8579d7ada36114ce2ca0bfd81f94c2f}{size}};                                           }
\DoxyCodeLine{80     \textcolor{keywordtype}{int} \mbox{\hyperlink{structreels_1_1ImageBlock_a0630a8d868491a21627e07c88deb8636}{block\_num}};                                     }
\DoxyCodeLine{81 }
\DoxyCodeLine{82     uint8\_t \mbox{\hyperlink{structreels_1_1ImageBlock_a461902d2703e372fe93d7ce43983fb9e}{buffer}}[\mbox{\hyperlink{reels_8h_a75cc8eb3d48ceda2913f0c5c9a39edc3}{IMAGE\_BUFF\_SIZE}}];                   }
\DoxyCodeLine{83 \};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{keyword}{typedef} std::vector<ImageBlock>         \mbox{\hyperlink{namespacereels_ad0d2080a74e1cd4f00a9280923bd3283}{BinaryImage}}; }
\DoxyCodeLine{87 \textcolor{keyword}{typedef} \mbox{\hyperlink{namespacereels_ad0d2080a74e1cd4f00a9280923bd3283}{BinaryImage}}                     *\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}};   }
\DoxyCodeLine{88 }
\DoxyCodeLine{89 }
\DoxyCodeLine{94 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1BinEventPt}{BinEventPt}} \{}
\DoxyCodeLine{95     \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} \mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}};                                      }
\DoxyCodeLine{96     \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} \mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}};                                      }
\DoxyCodeLine{97     \textcolor{keywordtype}{double} \mbox{\hyperlink{structreels_1_1BinEventPt_a3a84158eeac3bec39c1c324127458b86}{w}};                                          }
\DoxyCodeLine{98 }
\DoxyCodeLine{105     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structreels_1_1BinEventPt_af08980f08a1a08459e7bc1414542c3c4}{operator==}}(\textcolor{keyword}{const} \mbox{\hyperlink{structreels_1_1BinEventPt}{BinEventPt}} \&o)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{106         \textcolor{keywordflow}{return} \mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} == o.\mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} \&\& \mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}} == o.\mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}} \&\& round(\mbox{\hyperlink{reels_8h_ad22f076f2a3cd40135cd7aafe7a289fe}{WEIGHT\_PRECISION}}*\mbox{\hyperlink{structreels_1_1BinEventPt_a3a84158eeac3bec39c1c324127458b86}{w}}) == round(\mbox{\hyperlink{reels_8h_ad22f076f2a3cd40135cd7aafe7a289fe}{WEIGHT\_PRECISION}}*o.\mbox{\hyperlink{structreels_1_1BinEventPt_a3a84158eeac3bec39c1c324127458b86}{w}});}
\DoxyCodeLine{107     \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{115     \textcolor{keywordtype}{bool} \mbox{\hyperlink{structreels_1_1BinEventPt_a59169892f9565706dbc1fec8f52c2f82}{operator<}}(\textcolor{keyword}{const} \mbox{\hyperlink{structreels_1_1BinEventPt}{BinEventPt}} \&o)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{116         \textcolor{keywordflow}{return} \mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} < o.\mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} || (\mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} == o.\mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} \&\& \mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}} < o.\mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}}) || (\mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} == o.\mbox{\hyperlink{structreels_1_1BinEventPt_af1c176a8469ff7f8f8fb240ad087f5c3}{e}} \&\& \mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}} == o.\mbox{\hyperlink{structreels_1_1BinEventPt_a888668af385cd60b63f22b9c3d332bbd}{d}} \&\& round(\mbox{\hyperlink{reels_8h_ad22f076f2a3cd40135cd7aafe7a289fe}{WEIGHT\_PRECISION}}*\mbox{\hyperlink{structreels_1_1BinEventPt_a3a84158eeac3bec39c1c324127458b86}{w}}) < round(\mbox{\hyperlink{reels_8h_ad22f076f2a3cd40135cd7aafe7a289fe}{WEIGHT\_PRECISION}}*o.\mbox{\hyperlink{structreels_1_1BinEventPt_a3a84158eeac3bec39c1c324127458b86}{w}}));}
\DoxyCodeLine{117     \}}
\DoxyCodeLine{118 \};}
\DoxyCodeLine{119 }
\DoxyCodeLine{120 }
\DoxyCodeLine{125 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1BinTransaction}{BinTransaction}}: \mbox{\hyperlink{structreels_1_1BinEventPt}{BinEventPt}} \{}
\DoxyCodeLine{126     \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} \mbox{\hyperlink{structreels_1_1BinTransaction_a866a58e1ebd613c50acf74a133ffa6cf}{c}};                                      }
\DoxyCodeLine{127     \mbox{\hyperlink{namespacereels_a4a78105f5e060eeedd5b522e287efc9d}{TimePoint}} \mbox{\hyperlink{structreels_1_1BinTransaction_ac34ef6746838f054029bc08af0e6869d}{t}};                                      }
\DoxyCodeLine{128 \};}
\DoxyCodeLine{129 }
\DoxyCodeLine{130 }
\DoxyCodeLine{135 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1EventStat}{EventStat}} \{}
\DoxyCodeLine{136     uint64\_t \mbox{\hyperlink{structreels_1_1EventStat_a7d3ebf9f58fe9429f307e11cc7a5d12f}{seen}};              }
\DoxyCodeLine{137     uint64\_t \mbox{\hyperlink{structreels_1_1EventStat_ae14b56893bd9988687719235c4e982d9}{code}};              }
\DoxyCodeLine{138     uint64\_t \mbox{\hyperlink{structreels_1_1EventStat_a7f0ebd3bcc532128673c1b0e2387689b}{priority}};          }
\DoxyCodeLine{139 \};}
\DoxyCodeLine{140 }
\DoxyCodeLine{141 }
\DoxyCodeLine{146 \textcolor{keyword}{typedef} std::map<BinEventPt, EventStat> \mbox{\hyperlink{namespacereels_a753be4488a8c210f29ee5ccd95f672b9}{EventMap}};}
\DoxyCodeLine{147 }
\DoxyCodeLine{148 }
\DoxyCodeLine{153 \textcolor{keyword}{typedef} std::map<uint64\_t, BinEventPt> \mbox{\hyperlink{namespacereels_a3102c8c75ce0c85bb260c478b71fa90a}{PriorityMap}};}
\DoxyCodeLine{154 }
\DoxyCodeLine{155 }
\DoxyCodeLine{159 \textcolor{keyword}{typedef} std::map<uint64\_t, uint64\_t> \mbox{\hyperlink{namespacereels_ad23367fd7ac91cfd895fea61134f5e53}{EventCodeMap}};}
\DoxyCodeLine{160 }
\DoxyCodeLine{161 }
\DoxyCodeLine{165 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1CodeInTreeStatistics}{CodeInTreeStatistics}} \{}
\DoxyCodeLine{166     uint64\_t \mbox{\hyperlink{structreels_1_1CodeInTreeStatistics_a97e0770acc8c04a6fb8dc58b5d5d17a0}{n\_succ\_seen}};        }
\DoxyCodeLine{167     uint64\_t \mbox{\hyperlink{structreels_1_1CodeInTreeStatistics_a454ffa4668c040f6b59a175643422a35}{n\_succ\_target}};        }
\DoxyCodeLine{168     uint64\_t \mbox{\hyperlink{structreels_1_1CodeInTreeStatistics_ac9c08933e53d4e3716b4c03fd59493b0}{n\_incl\_seen}};        }
\DoxyCodeLine{169     uint64\_t \mbox{\hyperlink{structreels_1_1CodeInTreeStatistics_a78599c1a60e440029cb1e9dd3e51778d}{n\_incl\_target}};        }
\DoxyCodeLine{170     uint64\_t \mbox{\hyperlink{structreels_1_1CodeInTreeStatistics_abd294a86b371d86cd150d79c16285121}{sum\_dep}};            }
\DoxyCodeLine{171     \textcolor{keywordtype}{int}      \mbox{\hyperlink{structreels_1_1CodeInTreeStatistics_a553f7fa474a74cca45e4bd6c3ec8c0c5}{n\_dep}};                }
\DoxyCodeLine{172 \};}
\DoxyCodeLine{173 }
\DoxyCodeLine{174 }
\DoxyCodeLine{178 \textcolor{keyword}{typedef} std::map<uint64\_t, CodeInTreeStatistics> \mbox{\hyperlink{namespacereels_ad8514b34ba2d1a7ef5b6ed500479ed56}{CodeInTreeStatMap}};}
\DoxyCodeLine{179 }
\DoxyCodeLine{180 }
\DoxyCodeLine{184 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1StringUsage}{StringUsage}} \{}
\DoxyCodeLine{185     uint64\_t \mbox{\hyperlink{structreels_1_1StringUsage_af4424577c93f52606f886bd30284951f}{seen}};  }
\DoxyCodeLine{186     \mbox{\hyperlink{namespacereels_a8439b64892718b921e015accbfad1478}{String}} \mbox{\hyperlink{structreels_1_1StringUsage_a1865409e3da373b6338214ad6ddfb3cf}{str}};        }
\DoxyCodeLine{187 \};}
\DoxyCodeLine{188 }
\DoxyCodeLine{189 }
\DoxyCodeLine{194 \textcolor{keyword}{typedef} std::map<ElementHash, StringUsage> \mbox{\hyperlink{namespacereels_af2b9d59d7a42cbf383aa707de86ee9a8}{StringUsageMap}};}
\DoxyCodeLine{195 }
\DoxyCodeLine{196 }
\DoxyCodeLine{201 \textcolor{keyword}{typedef} std::vector<ElementHash> \mbox{\hyperlink{namespacereels_a2f35b05990dd7c5c01448a07bf89723c}{ClientIDs}};}
\DoxyCodeLine{202 }
\DoxyCodeLine{203 }
\DoxyCodeLine{208 \textcolor{keyword}{typedef} std::set<ElementHash> \mbox{\hyperlink{namespacereels_a73a7ae63cbb27d7caabe69e99ec19646}{ClientIDSet}};}
\DoxyCodeLine{209 }
\DoxyCodeLine{210 }
\DoxyCodeLine{213 \textcolor{keyword}{typedef} std::map<TimePoint, uint64\_t> \mbox{\hyperlink{namespacereels_a2f6d86b83946e88c6e43e7c1b476f0b4}{Clip}};}
\DoxyCodeLine{214 }
\DoxyCodeLine{215 }
\DoxyCodeLine{220 \textcolor{keyword}{typedef} std::map<ElementHash, Clip> \mbox{\hyperlink{namespacereels_a603b492f253098a318c7cece8dc26181}{ClipMap}};}
\DoxyCodeLine{221 \textcolor{keyword}{typedef} \mbox{\hyperlink{namespacereels_a603b492f253098a318c7cece8dc26181}{ClipMap}} * \mbox{\hyperlink{namespacereels_a967ca40ad0410dcf5f4ff55206a988ff}{pClipMap}};  }
\DoxyCodeLine{222 }
\DoxyCodeLine{223 }
\DoxyCodeLine{228 \textcolor{keyword}{typedef} std::map<ElementHash, TimePoint> \mbox{\hyperlink{namespacereels_ad37c6476c649ff89a1e3b08ae308ac18}{TargetMap}};}
\DoxyCodeLine{229 \textcolor{keyword}{typedef} \mbox{\hyperlink{namespacereels_ad37c6476c649ff89a1e3b08ae308ac18}{TargetMap}} * \mbox{\hyperlink{namespacereels_a0fd1b6d201e1eec9fdbe8940245b5d8d}{pTargetMap}};                  }
\DoxyCodeLine{230 }
\DoxyCodeLine{231 }
\DoxyCodeLine{236 \textcolor{keyword}{typedef} std::vector<double> \mbox{\hyperlink{namespacereels_afab3fdb12dfcf2726f495bd074225411}{TimesToTarget}};}
\DoxyCodeLine{237 }
\DoxyCodeLine{238 }
\DoxyCodeLine{241 \textcolor{keyword}{typedef} std::set<uint64\_t> \mbox{\hyperlink{namespacereels_a160646a36c079403d0afebd76a4d16cf}{CodeSet}};}
\DoxyCodeLine{242 \textcolor{keyword}{typedef} \mbox{\hyperlink{namespacereels_a160646a36c079403d0afebd76a4d16cf}{CodeSet}} * \mbox{\hyperlink{namespacereels_ae76ecaa3940df39d3b8fa491fc62246c}{pCodeSet}};                  }
\DoxyCodeLine{243 }
\DoxyCodeLine{244 }
\DoxyCodeLine{247 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1OptimizeEvalItem}{OptimizeEvalItem}} \{}
\DoxyCodeLine{248     \textcolor{keywordtype}{double}      \mbox{\hyperlink{structreels_1_1OptimizeEvalItem_ac875a125a91dc580f1dfb0614f00b8dc}{t\_hat}};     }
\DoxyCodeLine{249     \mbox{\hyperlink{namespacereels_a4a78105f5e060eeedd5b522e287efc9d}{TimePoint}}  \mbox{\hyperlink{structreels_1_1OptimizeEvalItem_a919fee1a2efad8270433323191d1e6d5}{t\_obs}};     }
\DoxyCodeLine{250     \textcolor{keywordtype}{int}         \mbox{\hyperlink{structreels_1_1OptimizeEvalItem_a9f7b657fabf5c5d5e93dd7b11d978b15}{seq\_len}}; }
\DoxyCodeLine{251 \};}
\DoxyCodeLine{252 }
\DoxyCodeLine{253 }
\DoxyCodeLine{256 \textcolor{keyword}{typedef} std::vector<OptimizeEvalItem>   \mbox{\hyperlink{namespacereels_a085f2a70bd9319a74fcba2295b958e9e}{OptimizeEval}};}
\DoxyCodeLine{257 }
\DoxyCodeLine{258 }
\DoxyCodeLine{261 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1CodeScoreItem}{CodeScoreItem}} \{}
\DoxyCodeLine{262     uint64\_t    \mbox{\hyperlink{structreels_1_1CodeScoreItem_a868cbd03dbd1b254b6a5acda16ee4e5a}{code}};   }
\DoxyCodeLine{263     \textcolor{keywordtype}{double}      \mbox{\hyperlink{structreels_1_1CodeScoreItem_a168650df01f25bf6ec222c2adbec8a61}{score}}; }
\DoxyCodeLine{264 \};}
\DoxyCodeLine{265 }
\DoxyCodeLine{266 }
\DoxyCodeLine{269 \textcolor{keyword}{typedef} std::vector <CodeScoreItem> \mbox{\hyperlink{namespacereels_a0003bf321a0a67c2609068f322a72b93}{CodeScores}};}
\DoxyCodeLine{270 }
\DoxyCodeLine{271 }
\DoxyCodeLine{274 \textcolor{keyword}{typedef} std::map<uint64\_t, int> \mbox{\hyperlink{namespacereels_a9a4100c2745268c213a5e49ba813c9fe}{ChildIndex}};}
\DoxyCodeLine{275 }
\DoxyCodeLine{276 }
\DoxyCodeLine{279 \textcolor{keyword}{struct }\mbox{\hyperlink{structreels_1_1CodeTreeNode}{CodeTreeNode}} \{}
\DoxyCodeLine{280     uint64\_t   \mbox{\hyperlink{structreels_1_1CodeTreeNode_a14d64da0c8561f09ed33d11e57860e82}{n\_seen}};        }
\DoxyCodeLine{281     uint64\_t   \mbox{\hyperlink{structreels_1_1CodeTreeNode_a145bc4c7e28bb08a825a3e9e6536cd64}{n\_target}};    }
\DoxyCodeLine{282     \mbox{\hyperlink{namespacereels_a0e17cc783e9a6a6e802c866ec6c9f003}{ExtFloat}}   \mbox{\hyperlink{structreels_1_1CodeTreeNode_a1c2655c80dc99eea71243ee1b500c5fd}{sum\_time\_d}};    }
\DoxyCodeLine{283     \mbox{\hyperlink{namespacereels_a9a4100c2745268c213a5e49ba813c9fe}{ChildIndex}} \mbox{\hyperlink{structreels_1_1CodeTreeNode_a329f4b0afda52347ed1727a929027fee}{child}};        }
\DoxyCodeLine{284 \};}
\DoxyCodeLine{285 \textcolor{keyword}{typedef} \mbox{\hyperlink{structreels_1_1CodeTreeNode}{CodeTreeNode}} * \mbox{\hyperlink{namespacereels_a5d95cbf5c5aeea11aee17d84e67a699b}{pCodeTreeNode}};          }
\DoxyCodeLine{286 }
\DoxyCodeLine{287 }
\DoxyCodeLine{292 \textcolor{keyword}{typedef} std::vector<CodeTreeNode>   \mbox{\hyperlink{namespacereels_ae33576cf78c338400805eb04d8e9ada8}{CodeTree}};}
\DoxyCodeLine{293 \textcolor{keyword}{typedef} \mbox{\hyperlink{namespacereels_ae33576cf78c338400805eb04d8e9ada8}{CodeTree}} * \mbox{\hyperlink{namespacereels_a1d46156e5435a796e0994528e1cf0c54}{pCodeTree}};                  }
\DoxyCodeLine{294 }
\DoxyCodeLine{295 }
\DoxyCodeLine{298 \textcolor{keyword}{enum} \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06}{Transform}} \{\mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06a511e869b28f666b9168b58ef856645fd}{tr\_undefined}}, \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06a4b9602e56146fa8c77c7861b8726633f}{tr\_linear}}, \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06a575d0fbcfea9d42b7f2348746687fe36}{tr\_log}}\};}
\DoxyCodeLine{299 }
\DoxyCodeLine{300 }
\DoxyCodeLine{303 \textcolor{keyword}{enum} \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946}{Aggregate}} \{\mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a3b7d4491a0d49afd2c4b96d3803268f7}{ag\_undefined}}, \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a92164951b62ea118117f2e019b1dd67e}{ag\_mean}}, \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946ac00291f88dffbf9369188215fbc35cfa}{ag\_minimax}}, \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a857ca6f10774405e691bdbbe3491e4fa}{ag\_longest}}\};}
\DoxyCodeLine{304 }
\DoxyCodeLine{305 }
\DoxyCodeLine{306 \textcolor{comment}{// Forward declaration of utilities used in other functions.}}
\DoxyCodeLine{307 uint64\_t \mbox{\hyperlink{namespacereels_aea29224c74ab1bbd3337bc9e22fca30b}{MurmurHash64A}} (\textcolor{keyword}{const} \textcolor{keywordtype}{void} *key, \textcolor{keywordtype}{int} len);}
\DoxyCodeLine{308 \textcolor{keywordtype}{bool} \mbox{\hyperlink{namespacereels_aa589037ff1304165b2b9736c08bf3f66}{image\_put}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} p\_bi, \textcolor{keywordtype}{void} *p\_data, \textcolor{keywordtype}{int} size);}
\DoxyCodeLine{309 \textcolor{keywordtype}{bool} \mbox{\hyperlink{namespacereels_af8e91bb1d1a511412c0ddc5bb3b490c5}{image\_get}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} p\_bi, \textcolor{keywordtype}{int} \&c\_block, \textcolor{keywordtype}{int} \&c\_ofs, \textcolor{keywordtype}{void} *p\_data, \textcolor{keywordtype}{int} size);}
\DoxyCodeLine{310 }
\DoxyCodeLine{311 }
\DoxyCodeLine{314 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1Logger}{Logger}} \{}
\DoxyCodeLine{315 }
\DoxyCodeLine{316     \textcolor{keyword}{public}:}
\DoxyCodeLine{317 }
\DoxyCodeLine{325         \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Logger_a910e75a2396bad1bd5c3c13c1ea22797}{log\_printf}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, ...) \{}
\DoxyCodeLine{326             va\_list args;}
\DoxyCodeLine{327             va\_start(args, fmt);}
\DoxyCodeLine{328             \mbox{\hyperlink{classreels_1_1Logger_a910e75a2396bad1bd5c3c13c1ea22797}{log\_printf}}(fmt, args);}
\DoxyCodeLine{329             va\_end(args);}
\DoxyCodeLine{330         \}}
\DoxyCodeLine{331 }
\DoxyCodeLine{337         \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Logger_a8e1216e4ae9ce9cece84ab1acb30b591}{log\_printf}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *fmt, va\_list args) \{}
\DoxyCodeLine{338             \textcolor{keywordtype}{char} buffer[256];}
\DoxyCodeLine{339 }
\DoxyCodeLine{340             vsnprintf(buffer, \textcolor{keyword}{sizeof}(buffer), fmt, args);}
\DoxyCodeLine{341 }
\DoxyCodeLine{342             \mbox{\hyperlink{classreels_1_1Logger_a0d3cb8eaed0912071e4a610227d694ff}{log}} = \mbox{\hyperlink{classreels_1_1Logger_a0d3cb8eaed0912071e4a610227d694ff}{log}} + buffer;}
\DoxyCodeLine{343         \}}
\DoxyCodeLine{344 }
\DoxyCodeLine{347         \mbox{\hyperlink{namespacereels_a8439b64892718b921e015accbfad1478}{String}} \mbox{\hyperlink{classreels_1_1Logger_a0d3cb8eaed0912071e4a610227d694ff}{log}} = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{348 \};}
\DoxyCodeLine{349 }
\DoxyCodeLine{350 }
\DoxyCodeLine{351 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1Clips}{Clips}};       \textcolor{comment}{// Forward declaration}}
\DoxyCodeLine{352 }
\DoxyCodeLine{363 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1Events}{Events}} \{}
\DoxyCodeLine{364 }
\DoxyCodeLine{365     \textcolor{keyword}{public}:}
\DoxyCodeLine{366 }
\DoxyCodeLine{367         \mbox{\hyperlink{classreels_1_1Events_aef74cff3f8e9d0c3b8bf8d385c842bf6}{Events}}() \{\}}
\DoxyCodeLine{368 }
\DoxyCodeLine{369         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Events_a9230f0a37efd84255d1abc0c9d158b1d}{store\_strings}} = \textcolor{keyword}{true};                     }
\DoxyCodeLine{370         \textcolor{keywordtype}{int}  \mbox{\hyperlink{classreels_1_1Events_afd8afb0326fc16de30c37b930329c322}{max\_num\_events}}   = \mbox{\hyperlink{reels_8h_aa114cba4c4b560e47f447c898d8f4dfb}{DEFAULT\_NUM\_EVENTS}};     }
\DoxyCodeLine{371 }
\DoxyCodeLine{372 }
\DoxyCodeLine{382         \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Events_a437b2281880b356ccf8586e5a982f4d5}{insert\_row}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_e,}
\DoxyCodeLine{383                         \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_d,}
\DoxyCodeLine{384                         \textcolor{keywordtype}{double} w);}
\DoxyCodeLine{385 }
\DoxyCodeLine{386 }
\DoxyCodeLine{399         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Events_a601dc6b767f5fcea7128a1a3280c0db6}{define\_event}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}}       p\_e,}
\DoxyCodeLine{400                           \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}}       p\_d,}
\DoxyCodeLine{401                           \textcolor{keywordtype}{double}   w,}
\DoxyCodeLine{402                           uint64\_t code);}
\DoxyCodeLine{403 }
\DoxyCodeLine{404 }
\DoxyCodeLine{443         \mbox{\hyperlink{namespacereels_a8439b64892718b921e015accbfad1478}{String}} \mbox{\hyperlink{classreels_1_1Events_a04a7255b61547f049cf370af2a0411ec}{optimize\_events}} (\mbox{\hyperlink{classreels_1_1Clips}{Clips}} \&\mbox{\hyperlink{reels_8cpp_a6305b7146e5de73a648a38b46d1ac549}{clips}}, \mbox{\hyperlink{namespacereels_ad37c6476c649ff89a1e3b08ae308ac18}{TargetMap}} \&\mbox{\hyperlink{reels_8cpp_ad6a5c79e1d169ef1a4db6c30c58252b2}{targets}}, \textcolor{keywordtype}{int} num\_steps = 10, \textcolor{keywordtype}{int} codes\_per\_step = 5, \textcolor{keywordtype}{double} threshold = 0.0001,}
\DoxyCodeLine{444                                 \mbox{\hyperlink{namespacereels_ae76ecaa3940df39d3b8fa491fc62246c}{pCodeSet}} p\_force\_include = \textcolor{keyword}{nullptr}, \mbox{\hyperlink{namespacereels_ae76ecaa3940df39d3b8fa491fc62246c}{pCodeSet}} p\_force\_exclude = \textcolor{keyword}{nullptr}, \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06}{Transform}} x\_form = \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06a4b9602e56146fa8c77c7861b8726633f}{tr\_linear}},}
\DoxyCodeLine{445                                 \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946}{Aggregate}} agg = \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a857ca6f10774405e691bdbbe3491e4fa}{ag\_longest}}, \textcolor{keywordtype}{double} p = 0.5, \textcolor{keywordtype}{int} depth = 1000, \textcolor{keywordtype}{bool} as\_states = \textcolor{keyword}{true},}
\DoxyCodeLine{446                                 \textcolor{keywordtype}{double} exp\_decay = 0.00693, \textcolor{keywordtype}{double} lower\_bound\_p = 0.95, \textcolor{keywordtype}{bool} log\_lift = \textcolor{keyword}{true});}
\DoxyCodeLine{447 }
\DoxyCodeLine{448 }
\DoxyCodeLine{467         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Events_ab280c7b4b4fe194570537b3e88c298a9}{score\_model}}(\textcolor{keywordtype}{double} \&score, \textcolor{keywordtype}{double} \&targ\_prop, \mbox{\hyperlink{namespacereels_ad8514b34ba2d1a7ef5b6ed500479ed56}{CodeInTreeStatMap}} \&codes\_stat, \textcolor{keywordtype}{bool} calc\_tree\_stats, \mbox{\hyperlink{classreels_1_1Clips}{Clips}} \&\mbox{\hyperlink{reels_8cpp_a6305b7146e5de73a648a38b46d1ac549}{clips}},}
\DoxyCodeLine{468                          \mbox{\hyperlink{namespacereels_ad37c6476c649ff89a1e3b08ae308ac18}{TargetMap}} \&\mbox{\hyperlink{reels_8cpp_ad6a5c79e1d169ef1a4db6c30c58252b2}{targets}}, \mbox{\hyperlink{namespacereels_ad23367fd7ac91cfd895fea61134f5e53}{EventCodeMap}} code\_dict, \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06}{Transform}} x\_form, \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946}{Aggregate}} agg, \textcolor{keywordtype}{double} p, \textcolor{keywordtype}{int} depth, \textcolor{keywordtype}{bool} as\_states);}
\DoxyCodeLine{469 }
\DoxyCodeLine{470 }
\DoxyCodeLine{483         \mbox{\hyperlink{namespacereels_a0003bf321a0a67c2609068f322a72b93}{CodeScores}} \mbox{\hyperlink{classreels_1_1Events_ae3546332ef86c25797c4bd194fe50076}{get\_top\_codes}}(\mbox{\hyperlink{namespacereels_ad8514b34ba2d1a7ef5b6ed500479ed56}{CodeInTreeStatMap}} \&codes\_stat, \textcolor{keywordtype}{double} targ\_prop, \textcolor{keywordtype}{double} exp\_decay, \textcolor{keywordtype}{double} lower\_bound\_p,}
\DoxyCodeLine{484                                  \textcolor{keywordtype}{bool} log\_lift);}
\DoxyCodeLine{485 }
\DoxyCodeLine{486 }
\DoxyCodeLine{493         \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Events_a8cba11f94673a7045f4d9737047788d3}{linear\_correlation}}(\mbox{\hyperlink{namespacereels_a085f2a70bd9319a74fcba2295b958e9e}{OptimizeEval}} \&ev) \{}
\DoxyCodeLine{494             \mbox{\hyperlink{namespacereels_a0e17cc783e9a6a6e802c866ec6c9f003}{ExtFloat}} s\_h = 0, s\_o = 0, sho = 0, ssh = 0, sso = 0;}
\DoxyCodeLine{495             \textcolor{keywordtype}{int} n = 0;}
\DoxyCodeLine{496 }
\DoxyCodeLine{497             \textcolor{keywordflow}{for} (OptimizeEval::iterator it = ev.begin(); it != ev.end(); ++it) \{}
\DoxyCodeLine{498                 \textcolor{keywordflow}{if} (it-\/>t\_obs != 0) \{}
\DoxyCodeLine{499                     s\_h += it-\/>t\_hat;}
\DoxyCodeLine{500                     s\_o += it-\/>t\_obs;}
\DoxyCodeLine{501                     sho += it-\/>t\_hat*it-\/>t\_obs;}
\DoxyCodeLine{502                     ssh += it-\/>t\_hat*it-\/>t\_hat;}
\DoxyCodeLine{503                     sso += it-\/>t\_obs*it-\/>t\_obs;}
\DoxyCodeLine{504 }
\DoxyCodeLine{505                     n++;}
\DoxyCodeLine{506                 \}}
\DoxyCodeLine{507             \}}
\DoxyCodeLine{508             \textcolor{keywordflow}{if} (n == 0)}
\DoxyCodeLine{509                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{510 }
\DoxyCodeLine{511             \textcolor{keywordtype}{double} d2 = (n*ssh -\/ s\_h*s\_h)*(n*sso -\/ s\_o*s\_o);}
\DoxyCodeLine{512 }
\DoxyCodeLine{513             \textcolor{keywordflow}{if} (d2 <= 1e-\/20)}
\DoxyCodeLine{514                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{515 }
\DoxyCodeLine{516             \textcolor{keywordflow}{return} (n*sho -\/ s\_h*s\_o)/sqrt(d2);}
\DoxyCodeLine{517         \}}
\DoxyCodeLine{518 }
\DoxyCodeLine{519 }
\DoxyCodeLine{526         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Events_a464476e8cc5dec6256e29a97392a957d}{load}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{527 }
\DoxyCodeLine{528 }
\DoxyCodeLine{537         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Events_a464476e8cc5dec6256e29a97392a957d}{load}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi, \textcolor{keywordtype}{int} \&c\_block, \textcolor{keywordtype}{int} \&c\_ofs);}
\DoxyCodeLine{538 }
\DoxyCodeLine{539 }
\DoxyCodeLine{546         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Events_a83f1ba063a2cb7a124ee04432ded5c81}{save}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{547 }
\DoxyCodeLine{548 }
\DoxyCodeLine{553         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Events_aeb8fdeaf66f9097c2df4a0d06e56c746}{set\_max\_num\_events}}(\textcolor{keywordtype}{int} max\_events) \{}
\DoxyCodeLine{554             \mbox{\hyperlink{classreels_1_1Events_afd8afb0326fc16de30c37b930329c322}{max\_num\_events}} = max\_events;}
\DoxyCodeLine{555         \}}
\DoxyCodeLine{556 }
\DoxyCodeLine{557 }
\DoxyCodeLine{562         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Events_ae60b1cc227efd4b5839f01cd0af8d11a}{set\_store\_strings}}(\textcolor{keywordtype}{bool} store) \{}
\DoxyCodeLine{563             \mbox{\hyperlink{classreels_1_1Events_a9230f0a37efd84255d1abc0c9d158b1d}{store\_strings}} = store;}
\DoxyCodeLine{564         \}}
\DoxyCodeLine{565 }
\DoxyCodeLine{566 }
\DoxyCodeLine{573         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} \mbox{\hyperlink{classreels_1_1Events_a7a43a9ee44caf7580e943038e44ffa16}{add\_str}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_str) \{}
\DoxyCodeLine{574             \textcolor{keywordtype}{int} ll = strlen(p\_str);}
\DoxyCodeLine{575 }
\DoxyCodeLine{576             \textcolor{keywordflow}{if} (!ll)}
\DoxyCodeLine{577                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{578 }
\DoxyCodeLine{579             \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} hash = \mbox{\hyperlink{namespacereels_aea29224c74ab1bbd3337bc9e22fca30b}{MurmurHash64A}}(p\_str, ll);}
\DoxyCodeLine{580 }
\DoxyCodeLine{581             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{classreels_1_1Events_a9230f0a37efd84255d1abc0c9d158b1d}{store\_strings}})}
\DoxyCodeLine{582                 \textcolor{keywordflow}{return} hash;}
\DoxyCodeLine{583 }
\DoxyCodeLine{584             StringUsageMap::iterator it = names\_map.find(hash);}
\DoxyCodeLine{585 }
\DoxyCodeLine{586             \textcolor{keywordflow}{if} (it != names\_map.end())}
\DoxyCodeLine{587                 it-\/>second.seen++;}
\DoxyCodeLine{588             \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{589                 \mbox{\hyperlink{structreels_1_1StringUsage}{StringUsage}} su = \{1, p\_str\};}
\DoxyCodeLine{590 }
\DoxyCodeLine{591                 names\_map[hash] = su;}
\DoxyCodeLine{592             \}}
\DoxyCodeLine{593             \textcolor{keywordflow}{return} hash;}
\DoxyCodeLine{594         \}}
\DoxyCodeLine{595 }
\DoxyCodeLine{596 }
\DoxyCodeLine{602         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Events_a5e13b0bf07486252e86e553d3c45b664}{erase\_str}}(\mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} hash) \{}
\DoxyCodeLine{603 }
\DoxyCodeLine{604             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classreels_1_1Events_a9230f0a37efd84255d1abc0c9d158b1d}{store\_strings}}) \{}
\DoxyCodeLine{605                 StringUsageMap::iterator it = names\_map.find(hash);}
\DoxyCodeLine{606 }
\DoxyCodeLine{607                 \textcolor{keywordflow}{if} (it != names\_map.end()) \{}
\DoxyCodeLine{608                     \textcolor{keywordflow}{if} (-\/-\/it-\/>second.seen == 0)}
\DoxyCodeLine{609                         names\_map.erase(it);}
\DoxyCodeLine{610                 \}}
\DoxyCodeLine{611             \}}
\DoxyCodeLine{612         \}}
\DoxyCodeLine{613 }
\DoxyCodeLine{614 }
\DoxyCodeLine{621         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a8439b64892718b921e015accbfad1478}{String}} \mbox{\hyperlink{classreels_1_1Events_ae3a42c1d6ad1d4250911ab9ce8d00f39}{get\_str}}(\mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} hash) \{}
\DoxyCodeLine{622 }
\DoxyCodeLine{623             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classreels_1_1Events_a9230f0a37efd84255d1abc0c9d158b1d}{store\_strings}}) \{}
\DoxyCodeLine{624                 \textcolor{keywordflow}{if} (!hash)}
\DoxyCodeLine{625                     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{626 }
\DoxyCodeLine{627                 StringUsageMap::iterator it = names\_map.find(hash);}
\DoxyCodeLine{628 }
\DoxyCodeLine{629                 \textcolor{keywordflow}{if} (it != names\_map.end())}
\DoxyCodeLine{630                     \textcolor{keywordflow}{return} it-\/>second.str;}
\DoxyCodeLine{631             \}}
\DoxyCodeLine{632             \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}\(\backslash\)x04"{}};}
\DoxyCodeLine{633         \}}
\DoxyCodeLine{634 }
\DoxyCodeLine{635 }
\DoxyCodeLine{642         \textcolor{keyword}{inline} uint64\_t \mbox{\hyperlink{classreels_1_1Events_a0bf53cb53fa984f0237d9cada3364c30}{event\_code}}(\mbox{\hyperlink{structreels_1_1BinEventPt}{BinEventPt}} \&ept) \{}
\DoxyCodeLine{643             EventMap::iterator it = \textcolor{keyword}{event}.find(ept);}
\DoxyCodeLine{644 }
\DoxyCodeLine{645             \textcolor{keywordflow}{if} (it == event.end())}
\DoxyCodeLine{646                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{647 }
\DoxyCodeLine{648             \textcolor{keywordflow}{return} it-\/>second.code;}
\DoxyCodeLine{649         \}}
\DoxyCodeLine{650 }
\DoxyCodeLine{651 }
\DoxyCodeLine{656         \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{classreels_1_1Events_a5249983ac63ead8eeecc5b6de7fb1fee}{num\_events}}() \{}
\DoxyCodeLine{657             \textcolor{keywordflow}{return} \textcolor{keyword}{event}.size();}
\DoxyCodeLine{658         \}}
\DoxyCodeLine{659 }
\DoxyCodeLine{660 }
\DoxyCodeLine{665         \textcolor{keyword}{inline} EventMap::iterator \mbox{\hyperlink{classreels_1_1Events_a4ecb634353f7b3f1d3867b2e51c50a6e}{events\_begin}}() \{}
\DoxyCodeLine{666             \textcolor{keywordflow}{return} \textcolor{keyword}{event}.begin();}
\DoxyCodeLine{667         \}}
\DoxyCodeLine{668 }
\DoxyCodeLine{669 }
\DoxyCodeLine{674         \textcolor{keyword}{inline} EventMap::iterator \mbox{\hyperlink{classreels_1_1Events_a51530f4a758147c1e6e908cb603565ff}{events\_end}}() \{}
\DoxyCodeLine{675             \textcolor{keywordflow}{return} \textcolor{keyword}{event}.end();}
\DoxyCodeLine{676         \}}
\DoxyCodeLine{677 }
\DoxyCodeLine{678 }
\DoxyCodeLine{685         \textcolor{keyword}{inline} EventMap::iterator \mbox{\hyperlink{classreels_1_1Events_a3aba01818244dd48315fe524234e3506}{events\_next\_after\_find}}(\mbox{\hyperlink{structreels_1_1BinEventPt}{BinEventPt}} \&ept) \{}
\DoxyCodeLine{686             EventMap::iterator it = \textcolor{keyword}{event}.find(ept);}
\DoxyCodeLine{687 }
\DoxyCodeLine{688             \textcolor{keywordflow}{if} (it != event.end())}
\DoxyCodeLine{689                 ++it;}
\DoxyCodeLine{690 }
\DoxyCodeLine{691             \textcolor{keywordflow}{return} it;}
\DoxyCodeLine{692         \}}
\DoxyCodeLine{693 }
\DoxyCodeLine{694 \textcolor{preprocessor}{\#ifndef TEST}}
\DoxyCodeLine{695     \textcolor{keyword}{private}:}
\DoxyCodeLine{696 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{697 }
\DoxyCodeLine{698         uint64\_t priority\_low = 0;}
\DoxyCodeLine{699         uint64\_t next\_code    = 0;}
\DoxyCodeLine{700 }
\DoxyCodeLine{701         \mbox{\hyperlink{namespacereels_af2b9d59d7a42cbf383aa707de86ee9a8}{StringUsageMap}} names\_map = \{\};}
\DoxyCodeLine{702         \mbox{\hyperlink{namespacereels_a753be4488a8c210f29ee5ccd95f672b9}{EventMap}}       \textcolor{keyword}{event}     = \{\};}
\DoxyCodeLine{703         \mbox{\hyperlink{namespacereels_a3102c8c75ce0c85bb260c478b71fa90a}{PriorityMap}}     priority  = \{\};}
\DoxyCodeLine{704 \};}
\DoxyCodeLine{705 }
\DoxyCodeLine{706 }
\DoxyCodeLine{710 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1Clients}{Clients}} \{}
\DoxyCodeLine{711 }
\DoxyCodeLine{712     \textcolor{keyword}{public}:}
\DoxyCodeLine{713 }
\DoxyCodeLine{714         \mbox{\hyperlink{classreels_1_1Clients_ac4cf6f647429f3ac92a1f78a2ecd878d}{Clients}}() \{\}}
\DoxyCodeLine{715 }
\DoxyCodeLine{716 }
\DoxyCodeLine{723         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} \mbox{\hyperlink{classreels_1_1Clients_a993a1fd1834a310f4ea70043545c6215}{hash\_client\_id}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_cli) \{}
\DoxyCodeLine{724             \textcolor{keywordtype}{int} ll = strlen(p\_cli);}
\DoxyCodeLine{725 }
\DoxyCodeLine{726             \textcolor{keywordflow}{return} ll == 0 ? 0 : \mbox{\hyperlink{namespacereels_aea29224c74ab1bbd3337bc9e22fca30b}{MurmurHash64A}}(p\_cli, ll);}
\DoxyCodeLine{727         \}}
\DoxyCodeLine{728 }
\DoxyCodeLine{729 }
\DoxyCodeLine{734         \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Clients_a2cab51f772851857f4e2d12eff1a4e2e}{add\_client\_id}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_cli);}
\DoxyCodeLine{735 }
\DoxyCodeLine{736 }
\DoxyCodeLine{743         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Clients_afda47b3ae3de3c1b61437df8baa4ee3c}{load}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{744 }
\DoxyCodeLine{745 }
\DoxyCodeLine{754         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Clients_afda47b3ae3de3c1b61437df8baa4ee3c}{load}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi, \textcolor{keywordtype}{int} \&c\_block, \textcolor{keywordtype}{int} \&c\_ofs);}
\DoxyCodeLine{755 }
\DoxyCodeLine{756 }
\DoxyCodeLine{763         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Clients_aedd701a5f04694571cdf145a4ee8c1fc}{save}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{764 }
\DoxyCodeLine{765         \mbox{\hyperlink{namespacereels_a2f35b05990dd7c5c01448a07bf89723c}{ClientIDs}}  \textcolor{keywordtype}{id}     = \{\};    }
\DoxyCodeLine{766         \mbox{\hyperlink{namespacereels_a73a7ae63cbb27d7caabe69e99ec19646}{ClientIDSet}} \mbox{\hyperlink{classreels_1_1Clients_afc689746c7165fc8b348c0c59c243db0}{id\_set}} = \{\};   }
\DoxyCodeLine{767 \};}
\DoxyCodeLine{768 }
\DoxyCodeLine{769 }
\DoxyCodeLine{772 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1TimeUtil}{TimeUtil}} \{}
\DoxyCodeLine{773 }
\DoxyCodeLine{774     \textcolor{keyword}{public}:}
\DoxyCodeLine{775 }
\DoxyCodeLine{776         \mbox{\hyperlink{classreels_1_1TimeUtil_a8ff69f2580fcd3e93a4e49297a385a7e}{TimeUtil}}() \{\}}
\DoxyCodeLine{777 }
\DoxyCodeLine{778         \textcolor{keywordtype}{char} \mbox{\hyperlink{classreels_1_1TimeUtil_ad026787163f981a528c58a1096ea57fc}{time\_format}}[128] = \textcolor{stringliteral}{"{}\%Y-\/\%m-\/\%d \%H:\%M:\%S"{}}; }
\DoxyCodeLine{779 }
\DoxyCodeLine{780 }
\DoxyCodeLine{787         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a4a78105f5e060eeedd5b522e287efc9d}{TimePoint}} \mbox{\hyperlink{classreels_1_1TimeUtil_ae8e19904eaec93a5c9a4f0e6e0792369}{get\_time}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_t) \{}
\DoxyCodeLine{788 }
\DoxyCodeLine{789             \mbox{\hyperlink{namespacereels_ab2c2070f5faa49767ec138bd7c6b8db5}{TimeStruct}} ts = \{0\};}
\DoxyCodeLine{790 }
\DoxyCodeLine{791             \textcolor{keywordflow}{if} (strptime(p\_t, \mbox{\hyperlink{classreels_1_1TimeUtil_ad026787163f981a528c58a1096ea57fc}{time\_format}}, \&ts) == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{792                 \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{793 }
\DoxyCodeLine{794             \textcolor{keywordflow}{return} timegm(\&ts);}
\DoxyCodeLine{795         \}}
\DoxyCodeLine{796 }
\DoxyCodeLine{797 }
\DoxyCodeLine{803         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1TimeUtil_ae45cac3f4e552d0128d3b82039896456}{set\_time\_format}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} fmt) \{}
\DoxyCodeLine{804             strncpy(\mbox{\hyperlink{classreels_1_1TimeUtil_ad026787163f981a528c58a1096ea57fc}{time\_format}}, fmt, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classreels_1_1TimeUtil_ad026787163f981a528c58a1096ea57fc}{time\_format}}) -\/ 1);}
\DoxyCodeLine{805         \}}
\DoxyCodeLine{806 \};}
\DoxyCodeLine{807 }
\DoxyCodeLine{808 }
\DoxyCodeLine{813 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1Clips}{Clips}} : \textcolor{keyword}{public} \mbox{\hyperlink{classreels_1_1TimeUtil}{TimeUtil}} \{}
\DoxyCodeLine{814 }
\DoxyCodeLine{815     \textcolor{keyword}{public}:}
\DoxyCodeLine{816 }
\DoxyCodeLine{820         \mbox{\hyperlink{classreels_1_1Clips_a50812a06667503006062af47a9964d43}{Clips}}() \{\}}
\DoxyCodeLine{821 }
\DoxyCodeLine{822 }
\DoxyCodeLine{828         \mbox{\hyperlink{classreels_1_1Clips_a6c15d4375b2c7efcf28921360ef47960}{Clips}}(\mbox{\hyperlink{classreels_1_1Clients}{Clients}} clients, \mbox{\hyperlink{classreels_1_1Events}{Events}} events) : \mbox{\hyperlink{reels_8cpp_a34446db4a13547becf65df7e3e1e531d}{clients}}(\mbox{\hyperlink{reels_8cpp_a34446db4a13547becf65df7e3e1e531d}{clients}}), \mbox{\hyperlink{reels_8cpp_adce2424a16866ae1bbce30758fc6ee65}{events}}(\mbox{\hyperlink{reels_8cpp_adce2424a16866ae1bbce30758fc6ee65}{events}}) \{\}}
\DoxyCodeLine{829 }
\DoxyCodeLine{830 }
\DoxyCodeLine{835         \mbox{\hyperlink{classreels_1_1Clips_a8cc6cdea54a86491531f2bde92c9c000}{Clips}}(\textcolor{keyword}{const} \mbox{\hyperlink{namespacereels_a603b492f253098a318c7cece8dc26181}{ClipMap}} \&\mbox{\hyperlink{classreels_1_1Clips_a021d03d443bd0fdcb1a60b1dbc21e5cb}{clip\_map}}) \{}
\DoxyCodeLine{836             clients = \mbox{\hyperlink{classreels_1_1Clients}{Clients}}();}
\DoxyCodeLine{837             events  = \mbox{\hyperlink{classreels_1_1Events}{Events}}();}
\DoxyCodeLine{838 }
\DoxyCodeLine{839             clips = \mbox{\hyperlink{classreels_1_1Clips_a021d03d443bd0fdcb1a60b1dbc21e5cb}{clip\_map}};}
\DoxyCodeLine{840         \}}
\DoxyCodeLine{841 }
\DoxyCodeLine{842 }
\DoxyCodeLine{847         \mbox{\hyperlink{classreels_1_1Clips_a7c9c88ee25eac25419cecda70b1dd17c}{Clips}}(\mbox{\hyperlink{classreels_1_1Clips}{Clips}} \&o\_clips) \{}
\DoxyCodeLine{848             \mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} p\_bi = \textcolor{keyword}{new} \mbox{\hyperlink{namespacereels_ad0d2080a74e1cd4f00a9280923bd3283}{BinaryImage}};}
\DoxyCodeLine{849 }
\DoxyCodeLine{850             o\_clips.\mbox{\hyperlink{classreels_1_1Clips_aeb24ae067eb0cee0a00adb0383f10371}{save}}(p\_bi);}
\DoxyCodeLine{851 }
\DoxyCodeLine{852             \mbox{\hyperlink{classreels_1_1Clips_a706fc3a60fef03151deda0a7f99e467e}{load}}(p\_bi);}
\DoxyCodeLine{853 }
\DoxyCodeLine{854             \textcolor{keyword}{delete} p\_bi;}
\DoxyCodeLine{855         \}}
\DoxyCodeLine{856 }
\DoxyCodeLine{857 }
\DoxyCodeLine{869         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Clips_a8955d5070c8128d68104eaf7bc0a8b31}{scan\_event}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_e,}
\DoxyCodeLine{870                         \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_d,}
\DoxyCodeLine{871                         \textcolor{keywordtype}{double} w,}
\DoxyCodeLine{872                         \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_c,}
\DoxyCodeLine{873                         \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_t);}
\DoxyCodeLine{874 }
\DoxyCodeLine{875 }
\DoxyCodeLine{883         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Clips_a3aae6f651b5dbd2cc96a9f70b31270ed}{insert\_event}}(\mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} client\_hash,}
\DoxyCodeLine{884                                  uint64\_t    code,}
\DoxyCodeLine{885                                  \mbox{\hyperlink{namespacereels_a4a78105f5e060eeedd5b522e287efc9d}{TimePoint}}  time\_pt) \{}
\DoxyCodeLine{886 }
\DoxyCodeLine{887             ClipMap::iterator it = clips.find(client\_hash);}
\DoxyCodeLine{888 }
\DoxyCodeLine{889             \textcolor{keywordflow}{if} (it == clips.end()) \{}
\DoxyCodeLine{890                 \mbox{\hyperlink{namespacereels_a2f6d86b83946e88c6e43e7c1b476f0b4}{Clip}} clip = \{\};}
\DoxyCodeLine{891 }
\DoxyCodeLine{892                 clip[time\_pt] = code;}
\DoxyCodeLine{893 }
\DoxyCodeLine{894                 clips[client\_hash] = clip;}
\DoxyCodeLine{895 }
\DoxyCodeLine{896             \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{897                 it-\/>second[time\_pt] = code;}
\DoxyCodeLine{898         \};}
\DoxyCodeLine{899 }
\DoxyCodeLine{900 }
\DoxyCodeLine{907         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Clips_a706fc3a60fef03151deda0a7f99e467e}{load}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{908 }
\DoxyCodeLine{909 }
\DoxyCodeLine{916         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Clips_aeb24ae067eb0cee0a00adb0383f10371}{save}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{917 }
\DoxyCodeLine{918 }
\DoxyCodeLine{923         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a967ca40ad0410dcf5f4ff55206a988ff}{pClipMap}} \mbox{\hyperlink{classreels_1_1Clips_a021d03d443bd0fdcb1a60b1dbc21e5cb}{clip\_map}}() \{}
\DoxyCodeLine{924             \textcolor{keywordflow}{return} \&clips;}
\DoxyCodeLine{925         \}}
\DoxyCodeLine{926 }
\DoxyCodeLine{927 }
\DoxyCodeLine{932         \textcolor{keyword}{inline} uint64\_t \mbox{\hyperlink{classreels_1_1Clips_ab6831205dd7596c2a7b4880cbd6bebb6}{num\_events}}() \{}
\DoxyCodeLine{933 }
\DoxyCodeLine{934             uint64\_t ret = 0;}
\DoxyCodeLine{935 }
\DoxyCodeLine{936             \textcolor{keywordflow}{for} (ClipMap::iterator it = clips.begin(); it != clips.end(); ++it)}
\DoxyCodeLine{937                 ret += it-\/>second.size();}
\DoxyCodeLine{938 }
\DoxyCodeLine{939             \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{940         \}}
\DoxyCodeLine{941 }
\DoxyCodeLine{946         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Clips_a5183d5d53d4bca1d2c1f40c3cf80f658}{collapse\_to\_states}}() \{}
\DoxyCodeLine{947             \textcolor{keywordflow}{for} (ClipMap::iterator it\_client = clips.begin(); it\_client != clips.end(); ++it\_client) \{}
\DoxyCodeLine{948                 uint64\_t last\_code = 0xA30BdefacedCabal;}
\DoxyCodeLine{949                 \textcolor{keywordflow}{for} (Clip::const\_iterator it = it\_client-\/>second.cbegin(); it != it\_client-\/>second.cend();) \{}
\DoxyCodeLine{950                     uint64\_t code = it-\/>second;}
\DoxyCodeLine{951                     \textcolor{keywordflow}{if} (code == last\_code)}
\DoxyCodeLine{952                         it\_client-\/>second.erase(it++);}
\DoxyCodeLine{953                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{954                         ++it;}
\DoxyCodeLine{955                     last\_code = code;}
\DoxyCodeLine{956                 \}}
\DoxyCodeLine{957             \}}
\DoxyCodeLine{958         \}}
\DoxyCodeLine{959 }
\DoxyCodeLine{960 \textcolor{preprocessor}{\#ifndef TEST}}
\DoxyCodeLine{961     \textcolor{keyword}{private}:}
\DoxyCodeLine{962 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{963 }
\DoxyCodeLine{964         \mbox{\hyperlink{classreels_1_1Clients}{Clients}} clients;}
\DoxyCodeLine{965         \mbox{\hyperlink{classreels_1_1Events}{Events}}    events;}
\DoxyCodeLine{966         \mbox{\hyperlink{namespacereels_a603b492f253098a318c7cece8dc26181}{ClipMap}}  clips   = \{\};}
\DoxyCodeLine{967 \};}
\DoxyCodeLine{968 }
\DoxyCodeLine{969 }
\DoxyCodeLine{973 \textcolor{keyword}{class }\mbox{\hyperlink{classreels_1_1Targets}{Targets}}    : \textcolor{keyword}{public} \mbox{\hyperlink{classreels_1_1TimeUtil}{TimeUtil}} \{}
\DoxyCodeLine{974 }
\DoxyCodeLine{975     \textcolor{keyword}{public}:}
\DoxyCodeLine{976 }
\DoxyCodeLine{982         \mbox{\hyperlink{classreels_1_1Targets_a788c0a0b574885ad093398bea7081455}{Targets}}(\mbox{\hyperlink{namespacereels_a967ca40ad0410dcf5f4ff55206a988ff}{pClipMap}} p\_clips, \mbox{\hyperlink{namespacereels_ad37c6476c649ff89a1e3b08ae308ac18}{TargetMap}} target) : p\_clips(p\_clips), target(target) \{}
\DoxyCodeLine{983             \mbox{\hyperlink{structreels_1_1CodeTreeNode}{CodeTreeNode}} root = \{0, 0, 0, \{\}\};}
\DoxyCodeLine{984             tree.push\_back(root);}
\DoxyCodeLine{985         \}}
\DoxyCodeLine{986 }
\DoxyCodeLine{987 }
\DoxyCodeLine{998         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Targets_aa494e3e344558109a7586f5d46a8c65d}{insert\_target}}(\mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_c, \mbox{\hyperlink{namespacereels_a4c9a27f22e0b05c11ca77c43f0029ac1}{pChar}} p\_t);}
\DoxyCodeLine{999 }
\DoxyCodeLine{1000 }
\DoxyCodeLine{1015         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Targets_a09486f71a7545b25a5a396d87f459d29}{fit}}(\mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06}{Transform}} x\_form, \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946}{Aggregate}} agg, \textcolor{keywordtype}{double} p, \textcolor{keywordtype}{int} depth, \textcolor{keywordtype}{bool} as\_states);}
\DoxyCodeLine{1016 }
\DoxyCodeLine{1017 }
\DoxyCodeLine{1024         \mbox{\hyperlink{namespacereels_afab3fdb12dfcf2726f495bd074225411}{TimesToTarget}} \mbox{\hyperlink{classreels_1_1Targets_aefdb329ae8284265f37c6fee9f3a074a}{predict}}();}
\DoxyCodeLine{1025 }
\DoxyCodeLine{1026 }
\DoxyCodeLine{1037         \mbox{\hyperlink{namespacereels_afab3fdb12dfcf2726f495bd074225411}{TimesToTarget}} \mbox{\hyperlink{classreels_1_1Targets_aefdb329ae8284265f37c6fee9f3a074a}{predict}}(\mbox{\hyperlink{classreels_1_1Clients}{Clients}} \mbox{\hyperlink{reels_8cpp_a34446db4a13547becf65df7e3e1e531d}{clients}});}
\DoxyCodeLine{1038 }
\DoxyCodeLine{1039 }
\DoxyCodeLine{1048         \mbox{\hyperlink{namespacereels_afab3fdb12dfcf2726f495bd074225411}{TimesToTarget}} \mbox{\hyperlink{classreels_1_1Targets_aefdb329ae8284265f37c6fee9f3a074a}{predict}}(\mbox{\hyperlink{namespacereels_a967ca40ad0410dcf5f4ff55206a988ff}{pClipMap}} p\_clips);}
\DoxyCodeLine{1049 }
\DoxyCodeLine{1050 }
\DoxyCodeLine{1062         \textcolor{keywordtype}{void} \mbox{\hyperlink{classreels_1_1Targets_a428215b5a28ab3c607766c7f57c93f09}{verbose\_predict\_clip}}(\textcolor{keyword}{const} \mbox{\hyperlink{namespacereels_a60510fbcbc3a367de0a7061ea5a4a0fa}{ElementHash}} \&client,}
\DoxyCodeLine{1063                                   \mbox{\hyperlink{namespacereels_a2f6d86b83946e88c6e43e7c1b476f0b4}{Clip}}              \&clip,}
\DoxyCodeLine{1064                                   \mbox{\hyperlink{namespacereels_a4a78105f5e060eeedd5b522e287efc9d}{TimePoint}}            \&obs\_time,}
\DoxyCodeLine{1065                                   \textcolor{keywordtype}{bool}              \&target\_yn,}
\DoxyCodeLine{1066                                   \textcolor{keywordtype}{int}               \&longest\_seq,}
\DoxyCodeLine{1067                                   uint64\_t          \&n\_visits,}
\DoxyCodeLine{1068                                   uint64\_t          \&n\_targets,}
\DoxyCodeLine{1069                                   \textcolor{keywordtype}{double}            \&targ\_mean\_t);}
\DoxyCodeLine{1070 }
\DoxyCodeLine{1071 }
\DoxyCodeLine{1078         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Targets_a96b6945602462b00a810f3489f3a2288}{load}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{1079 }
\DoxyCodeLine{1080 }
\DoxyCodeLine{1087         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Targets_ac4a9e31f024d5b382fa48eec82bfcb9b}{save}}(\mbox{\hyperlink{namespacereels_ac5c80b0d8cbac5bce1bdf61c9251cc75}{pBinaryImage}} \&p\_bi);}
\DoxyCodeLine{1088 }
\DoxyCodeLine{1089 }
\DoxyCodeLine{1099         \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{classreels_1_1Targets_acc1ee6e15e1250af634a8167868c70ae}{update\_node}}(\textcolor{keywordtype}{int} idx\_parent, uint64\_t code, \textcolor{keywordtype}{bool} target, \mbox{\hyperlink{namespacereels_a0e17cc783e9a6a6e802c866ec6c9f003}{ExtFloat}} time\_d) \{}
\DoxyCodeLine{1100 }
\DoxyCodeLine{1101             \textcolor{keywordflow}{if} (idx\_parent == 0) \{      \textcolor{comment}{// The root node contains the prediction of the zero-\/length clip.}}
\DoxyCodeLine{1102                 tree[0].n\_seen++;}
\DoxyCodeLine{1103                 \textcolor{keywordflow}{if} (target) \{}
\DoxyCodeLine{1104                     tree[0].n\_target++;}
\DoxyCodeLine{1105                     tree[0].sum\_time\_d += time\_d;}
\DoxyCodeLine{1106                 \}}
\DoxyCodeLine{1107             \}}
\DoxyCodeLine{1108 }
\DoxyCodeLine{1109             ChildIndex::iterator it = tree[idx\_parent].child.find(code);}
\DoxyCodeLine{1110 }
\DoxyCodeLine{1111             \textcolor{keywordflow}{if} (it != tree[idx\_parent].child.end()) \{}
\DoxyCodeLine{1112                 \textcolor{keywordtype}{int} idx = it-\/>second;}
\DoxyCodeLine{1113 }
\DoxyCodeLine{1114                 tree[idx].n\_seen++;}
\DoxyCodeLine{1115                 \textcolor{keywordflow}{if} (target) \{}
\DoxyCodeLine{1116                     tree[idx].n\_target++;}
\DoxyCodeLine{1117                     tree[idx].sum\_time\_d += time\_d;}
\DoxyCodeLine{1118                 \}}
\DoxyCodeLine{1119 }
\DoxyCodeLine{1120                 \textcolor{keywordflow}{return} idx;}
\DoxyCodeLine{1121             \}}
\DoxyCodeLine{1122 }
\DoxyCodeLine{1123             \mbox{\hyperlink{structreels_1_1CodeTreeNode}{CodeTreeNode}} node = \{1, target, time\_d, \{\}\};}
\DoxyCodeLine{1124 }
\DoxyCodeLine{1125             tree.push\_back(node);}
\DoxyCodeLine{1126 }
\DoxyCodeLine{1127             \textcolor{keywordtype}{int} idx = tree.size() -\/ 1;}
\DoxyCodeLine{1128 }
\DoxyCodeLine{1129             tree[idx\_parent].child[code] = idx;}
\DoxyCodeLine{1130 }
\DoxyCodeLine{1131             \textcolor{keywordflow}{return} idx;}
\DoxyCodeLine{1132         \}}
\DoxyCodeLine{1133 }
\DoxyCodeLine{1134 }
\DoxyCodeLine{1141         \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Targets_a6dca89e79ea2f68868bd17326b5d19d5}{normal\_pdf}}(\textcolor{keywordtype}{double} x) \{}
\DoxyCodeLine{1142             \textcolor{comment}{// https://stackoverflow.com/questions/10847007/using-\/the-\/gaussian-\/probability-\/density-\/function-\/in-\/c}}
\DoxyCodeLine{1143 }
\DoxyCodeLine{1144             \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{double} inv\_sqrt\_2pi = 0.3989422804014327;}
\DoxyCodeLine{1145 }
\DoxyCodeLine{1146             \textcolor{keywordflow}{return} exp(-\/0.5*x*x)*inv\_sqrt\_2pi;}
\DoxyCodeLine{1147         \}}
\DoxyCodeLine{1148 }
\DoxyCodeLine{1149 }
\DoxyCodeLine{1156         \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Targets_afbff88985aa0045475304bc3a56b0ff3}{normal\_cdf}}(\textcolor{keywordtype}{double} x) \{}
\DoxyCodeLine{1157             \textcolor{comment}{// https://stackoverflow.com/questions/2328258/cumulative-\/normal-\/distribution-\/function-\/in-\/c-\/c}}
\DoxyCodeLine{1158             \textcolor{comment}{// https://cplusplus.com/reference/cmath/erfc/}}
\DoxyCodeLine{1159 }
\DoxyCodeLine{1160             \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{double} m\_sqrt\_dot\_5 = 0.7071067811865476;}
\DoxyCodeLine{1161 }
\DoxyCodeLine{1162             \textcolor{keywordflow}{return} 0.5*erfc(-\/x*m\_sqrt\_dot\_5);}
\DoxyCodeLine{1163         \}}
\DoxyCodeLine{1164 }
\DoxyCodeLine{1165 }
\DoxyCodeLine{1176         \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Targets_a2986f57a1a97ee8e1c7b2ffb816e3350}{agresti\_coull\_upper\_bound}}(uint64\_t n\_hits, uint64\_t n\_total) \{}
\DoxyCodeLine{1177             \textcolor{comment}{// https://github.com/msn0/agresti-\/coull-\/interval/blob/master/src/agresti.js}}
\DoxyCodeLine{1178 }
\DoxyCodeLine{1179             \textcolor{keywordtype}{double} n\_tilde = n\_total + binomial\_z\_sqr;}
\DoxyCodeLine{1180             \textcolor{keywordtype}{double} p\_tilde = (n\_hits + binomial\_z\_sqr\_div\_2)/n\_tilde;}
\DoxyCodeLine{1181             \textcolor{keywordtype}{double} a       = binomial\_z*sqrt(p\_tilde*(1 -\/ p\_tilde)/n\_tilde);}
\DoxyCodeLine{1182 }
\DoxyCodeLine{1183             \textcolor{keywordflow}{return} p\_tilde + a;}
\DoxyCodeLine{1184         \}}
\DoxyCodeLine{1185 }
\DoxyCodeLine{1186 }
\DoxyCodeLine{1197         \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Targets_abeacf235481ea5d461876c95b9d0288e}{agresti\_coull\_lower\_bound}}(uint64\_t n\_hits, uint64\_t n\_total) \{}
\DoxyCodeLine{1198             \textcolor{comment}{// https://github.com/msn0/agresti-\/coull-\/interval/blob/master/src/agresti.js}}
\DoxyCodeLine{1199 }
\DoxyCodeLine{1200             \textcolor{keywordtype}{double} n\_tilde = n\_total + binomial\_z\_sqr;}
\DoxyCodeLine{1201             \textcolor{keywordtype}{double} p\_tilde = (n\_hits + binomial\_z\_sqr\_div\_2)/n\_tilde;}
\DoxyCodeLine{1202             \textcolor{keywordtype}{double} a       = binomial\_z*sqrt(p\_tilde*(1 -\/ p\_tilde)/n\_tilde);}
\DoxyCodeLine{1203 }
\DoxyCodeLine{1204             \textcolor{keywordflow}{return} p\_tilde -\/ a;}
\DoxyCodeLine{1205         \}}
\DoxyCodeLine{1206 }
\DoxyCodeLine{1207 }
\DoxyCodeLine{1231         \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Targets_a80b4a813cca93acd4439d1d34036327b}{predict\_time}}(\mbox{\hyperlink{structreels_1_1CodeTreeNode}{CodeTreeNode}} \&node) \{}
\DoxyCodeLine{1232 }
\DoxyCodeLine{1233             \textcolor{keywordflow}{if} (node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a145bc4c7e28bb08a825a3e9e6536cd64}{n\_target}} <= 0)}
\DoxyCodeLine{1234                 \textcolor{keywordflow}{return} \mbox{\hyperlink{reels_8h_a08844c29f8b8dc51fd44de1370158b1a}{PREDICT\_MAX\_TIME}};}
\DoxyCodeLine{1235 }
\DoxyCodeLine{1236             \textcolor{keywordtype}{double} lb     = std::max(1e-\/4, \mbox{\hyperlink{classreels_1_1Targets_abeacf235481ea5d461876c95b9d0288e}{agresti\_coull\_lower\_bound}}(node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a145bc4c7e28bb08a825a3e9e6536cd64}{n\_target}}, node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a14d64da0c8561f09ed33d11e57860e82}{n\_seen}}));}
\DoxyCodeLine{1237             \textcolor{keywordtype}{double} mu\_hat = transform == \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06a4b9602e56146fa8c77c7861b8726633f}{tr\_linear}} ? ((double) node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a1c2655c80dc99eea71243ee1b500c5fd}{sum\_time\_d}})/node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a145bc4c7e28bb08a825a3e9e6536cd64}{n\_target}} : exp(((\textcolor{keywordtype}{double}) node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a1c2655c80dc99eea71243ee1b500c5fd}{sum\_time\_d}})/node.\mbox{\hyperlink{structreels_1_1CodeTreeNode_a145bc4c7e28bb08a825a3e9e6536cd64}{n\_target}});}
\DoxyCodeLine{1238 }
\DoxyCodeLine{1239             \textcolor{keywordflow}{return} mu\_hat/lb;}
\DoxyCodeLine{1240         \}}
\DoxyCodeLine{1241 }
\DoxyCodeLine{1242 }
\DoxyCodeLine{1249         \textcolor{keyword}{inline} \textcolor{keywordtype}{double} \mbox{\hyperlink{classreels_1_1Targets_aa0711b5c32e23aab8f4656be2484eab1}{predict\_clip}}(\mbox{\hyperlink{namespacereels_a2f6d86b83946e88c6e43e7c1b476f0b4}{Clip}} clip) \{}
\DoxyCodeLine{1250 }
\DoxyCodeLine{1251             \textcolor{keywordtype}{int} idx = 0, n = 0;}
\DoxyCodeLine{1252 }
\DoxyCodeLine{1253             \textcolor{keywordtype}{double} t[\mbox{\hyperlink{reels_8h_a2e7bcfe0de6bafe2bd8f0f397496bbd3}{MAX\_SEQ\_LEN\_IN\_PREDICT}}];}
\DoxyCodeLine{1254 }
\DoxyCodeLine{1255             \textcolor{keywordflow}{for} (Clip::reverse\_iterator it = clip.rbegin(); it != clip.rend(); it++) \{}
\DoxyCodeLine{1256                 ChildIndex::iterator jt = tree[idx].child.find(it-\/>second);}
\DoxyCodeLine{1257 }
\DoxyCodeLine{1258                 \textcolor{keywordflow}{if} (jt == tree[idx].child.end())}
\DoxyCodeLine{1259                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{1260 }
\DoxyCodeLine{1261                 idx = jt-\/>second;}
\DoxyCodeLine{1262 }
\DoxyCodeLine{1263                 t[n++] = \mbox{\hyperlink{classreels_1_1Targets_a80b4a813cca93acd4439d1d34036327b}{predict\_time}}(tree[idx]);}
\DoxyCodeLine{1264             \}}
\DoxyCodeLine{1265 }
\DoxyCodeLine{1266             \textcolor{keywordflow}{if} (n == 0)}
\DoxyCodeLine{1267                 \textcolor{keywordflow}{return} \mbox{\hyperlink{classreels_1_1Targets_a80b4a813cca93acd4439d1d34036327b}{predict\_time}}(tree[0]);}
\DoxyCodeLine{1268 }
\DoxyCodeLine{1269             \textcolor{keywordflow}{if} (aggregate == \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a857ca6f10774405e691bdbbe3491e4fa}{ag\_longest}})}
\DoxyCodeLine{1270                 \textcolor{keywordflow}{return} t[n -\/ 1];}
\DoxyCodeLine{1271 }
\DoxyCodeLine{1272             \textcolor{keywordtype}{double} ret = t[0];}
\DoxyCodeLine{1273 }
\DoxyCodeLine{1274             \textcolor{keywordflow}{if} (aggregate == \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a92164951b62ea118117f2e019b1dd67e}{ag\_mean}}) \{}
\DoxyCodeLine{1275                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < n; i++)}
\DoxyCodeLine{1276                     ret += t[i];}
\DoxyCodeLine{1277 }
\DoxyCodeLine{1278                 \textcolor{keywordflow}{return} ret/n;}
\DoxyCodeLine{1279             \}}
\DoxyCodeLine{1280 }
\DoxyCodeLine{1281             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < n; i++)}
\DoxyCodeLine{1282                 ret = std::min(ret, t[i]);}
\DoxyCodeLine{1283 }
\DoxyCodeLine{1284             \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{1285         \}}
\DoxyCodeLine{1286 }
\DoxyCodeLine{1287 }
\DoxyCodeLine{1298         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classreels_1_1Targets_af539c8e3fe2bc1a3f77f32e414bfcbfd}{recurse\_tree\_stats}}(\textcolor{keywordtype}{int} depth, \textcolor{keywordtype}{int} idx, \textcolor{keywordtype}{int} parent\_idx, uint64\_t code, \mbox{\hyperlink{namespacereels_ad8514b34ba2d1a7ef5b6ed500479ed56}{CodeInTreeStatMap}} \&codes\_stat);}
\DoxyCodeLine{1299 }
\DoxyCodeLine{1300 }
\DoxyCodeLine{1305         \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{classreels_1_1Targets_a194426a4f66ca447b433b1483c6f9b08}{num\_targets}}() \{}
\DoxyCodeLine{1306             \textcolor{keywordflow}{return} target.size();}
\DoxyCodeLine{1307         \}}
\DoxyCodeLine{1308 }
\DoxyCodeLine{1309 }
\DoxyCodeLine{1314         \textcolor{keyword}{inline} \textcolor{keywordtype}{int} \mbox{\hyperlink{classreels_1_1Targets_a625045e775f73503e3e9e61b753cfe05}{tree\_size}}() \{}
\DoxyCodeLine{1315             \textcolor{keywordflow}{return} tree.size();}
\DoxyCodeLine{1316         \}}
\DoxyCodeLine{1317 }
\DoxyCodeLine{1318 }
\DoxyCodeLine{1323         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a967ca40ad0410dcf5f4ff55206a988ff}{pClipMap}} \mbox{\hyperlink{classreels_1_1Targets_a2e193774de3a2ac5920fcac53aed4b6b}{clip\_map}}() \{}
\DoxyCodeLine{1324             \textcolor{keywordflow}{return} p\_clips;}
\DoxyCodeLine{1325         \}}
\DoxyCodeLine{1326 }
\DoxyCodeLine{1327 }
\DoxyCodeLine{1332         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a1d46156e5435a796e0994528e1cf0c54}{pCodeTree}} \mbox{\hyperlink{classreels_1_1Targets_a903da912dd75677cb03c3c41283d7f9d}{p\_tree}}() \{}
\DoxyCodeLine{1333             \textcolor{keywordflow}{return} \&tree;}
\DoxyCodeLine{1334         \}}
\DoxyCodeLine{1335 }
\DoxyCodeLine{1336 }
\DoxyCodeLine{1341         \textcolor{keyword}{inline} \mbox{\hyperlink{namespacereels_a0fd1b6d201e1eec9fdbe8940245b5d8d}{pTargetMap}} \mbox{\hyperlink{classreels_1_1Targets_a0a9bd52e830ad7fe7dd0e5ad07d808e1}{p\_target}}() \{}
\DoxyCodeLine{1342             \textcolor{keywordflow}{return} \&target;}
\DoxyCodeLine{1343         \}}
\DoxyCodeLine{1344 }
\DoxyCodeLine{1345 \textcolor{preprocessor}{\#ifndef TEST}}
\DoxyCodeLine{1346     \textcolor{keyword}{private}:}
\DoxyCodeLine{1347 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{1348 }
\DoxyCodeLine{1349         \mbox{\hyperlink{namespacereels_a967ca40ad0410dcf5f4ff55206a988ff}{pClipMap}}   p\_clips;}
\DoxyCodeLine{1350         \mbox{\hyperlink{namespacereels_ad37c6476c649ff89a1e3b08ae308ac18}{TargetMap}}  target;}
\DoxyCodeLine{1351         \mbox{\hyperlink{namespacereels_ae33576cf78c338400805eb04d8e9ada8}{CodeTree}}   tree                 = \{\};}
\DoxyCodeLine{1352         \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06}{Transform}}  transform           = \mbox{\hyperlink{namespacereels_ad44e06140c2e753acec63a0c7f59fa06a511e869b28f666b9168b58ef856645fd}{tr\_undefined}};}
\DoxyCodeLine{1353         \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946}{Aggregate}}  aggregate           = \mbox{\hyperlink{namespacereels_af9e843e456fd6d18c38b1758c8258946a3b7d4491a0d49afd2c4b96d3803268f7}{ag\_undefined}};}
\DoxyCodeLine{1354         \textcolor{keywordtype}{double}     binomial\_z           = 0;}
\DoxyCodeLine{1355         \textcolor{keywordtype}{double}     binomial\_z\_sqr       = 0;}
\DoxyCodeLine{1356         \textcolor{keywordtype}{double}     binomial\_z\_sqr\_div\_2 = 0;}
\DoxyCodeLine{1357         \textcolor{keywordtype}{int}        tree\_depth           = 0;}
\DoxyCodeLine{1358 \};}
\DoxyCodeLine{1359 }
\DoxyCodeLine{1360 \} \textcolor{comment}{// namespace reels}}
\DoxyCodeLine{1361 }
\DoxyCodeLine{1362 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// ifndef INCLUDED\_REELS\_TYPES}}

\end{DoxyCode}
